var nodebotui=function(){function a(a){return!isNaN(parseFloat(a))&&isFinite(a)}function b(){var a,b={},c=document.getElementsByTagName("form");for(a=0;a<c.length;a++)"board"===c[a].getAttribute("data-device-type")&&(b[c[a].id]=new j(c[a].attributes));return b}function c(a){return d(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a}function d(a,b,c){var d;if(null!==a)if(Array.prototype.forEach&&a.forEach===Array.prototype.forEach)a.forEach(b,c);else if(a.length===+a.length){for(d=0,length=a.length;length>d;d++)if(b.call(c,a[d],d,a)==={})return}else{var f=e(a);for(d=0,length=f.length;length>d;d++)if(b.call(c,a[f[d]],f[d],a)==={})return}}function e(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)hasOwnProperty.call(a,c)&&b.push(c);return b}var f,g,h={},j=function(a){return this instanceof j?(this._extendAttributes(a),this.getControls(a.id.nodeValue),void 0):new j(a)};j.prototype.getControls=function(a){var b=document.getElementById(this.id).getElementsByTagName("input");for(i=0;i<b.length;i++)b[i].hasAttribute("data-device-type")&&(this[b[i].id]=new k(b[i].attributes,a));var c=document.getElementById(this.id).getElementsByTagName("fieldset");for(i=0;i<c.length;i++)c[i].hasAttribute("data-device-type")&&(this["_"+c[i].id]=new k(c[i].attributes,a))},j.prototype.initialize=function(){d(this,function(a,b){"_"!==b.substring(0,1)&&a._initialize&&a._initialize()})},j.prototype._extendAttributes=function(a){var b,d,e={};for(b=0,d=a.length;d>b;b++)e[a.item(b).nodeName.replace("data-","")]=a.item(b).nodeValue;c(this,e)};var k=function(a,b){if(!(this instanceof k))return new k(a);var e=document.getElementById(a.id.nodeValue);this._board=b,this._ready=!1,this._extendAttributes(a),c(this,o[this["device-type"]],l[this["device-type"]],n[this.type]),this._extendAttributes(a),delete this.type,this._methods&&d(this._methods,function(a){this[a]=m[a]},this),delete this._methods,this._initialize&&this._initialize(e,this),this._listen&&this._listen(e,this)};k.prototype._extendAttributes=function(b){var d,e,f,g,h={};for(d=0,e=b.length;e>d;d++)g=b.item(d).nodeValue,f=b.item(d).nodeName.replace("data-",""),h[f]=a(g)?Number(g):g;c(this,h)};var l={Led:{min:0,max:255,_methods:["on","off","toggle","strobe","stop","pulse"]},Servo:{min:0,max:180,tolerance:0,_lastUpdate:-999,_methods:["move"]}},m={on:function(){f&&f.emit("call",{board:this._board,device:this.id,method:"on"}),this._update(!0)},off:function(){f&&f.emit("call",{board:this._board,device:this.id,method:"off"}),this._update(!1)},toggle:function(){f&&f.emit("call",{board:this._board,device:this.id,method:"toggle"})},stop:function(){f&&f.emit("call",{board:this._board,device:this.id,method:"stop"})},pulse:function(){f&&f.emit("call",{board:this._board,device:this.id,method:"pulse",params:this.phase})},strobe:function(){f&&f.emit("call",{board:this._board,device:this.id,method:"strobe",params:this.phase})},move:function(a){(null===a||"undefined"==typeof a)&&(a=Number(document.getElementById(this.id).value));var b=(a-this.inputMin)/(this.inputMax-this.inputMin);0>b&&(b=0),b>1&&(b=1),this.inverse&&(b=1-b);var c=b*(this.max-this.min)+this.min,d=c;"undefined"!=typeof this.easing&&(c=h[this.easing](c)),f&&g[this._board]._ready&&Number(this.tolerance)<=Math.abs(c-this._lastUpdate)&&(this._lastUpdate=c,f.emit("call",{board:this._board,device:this.id,method:"move",params:c,tolerance:this.tolerance})),this._update(d)}},n={checkbox:{_listen:function(a,b){a.addEventListener("change",function(){switch(b.mode){case"toggle":b.toggle();break;case"strobe":a.checked?b.strobe(this.phase):b.stop();break;case"pulse":a.checked?b.pulse(this.phase):b.stop();break;default:a.checked?b.on():b.off()}})},_update:function(a){document.getElementById(this.id).checked=a}},range:{_listen:function(a,b){a.addEventListener("change",function(){b.move()})},_update:function(a){document.getElementById(this.id).value=a},_initialize:function(){var a=document.getElementById(this.id);if(this.max=Number(a.getAttribute("max"))||this.max,a.setAttribute("max",this.max),this.min=Number(a.getAttribute("min"))||this.min,a.setAttribute("min",this.min),this.thresholds){var b=this.thresholds.split(",");this.inputMin=Number(b[0]),this.inputMax=Number(b[1])}else this.inputMin=this.min,this.inputMax=this.max}}},o={deviceOrientation:{_listen:function(a,b){window.addEventListener("deviceorientation",function(a){d(["alpha","beta","gamma"],function(b){this[b+"Input"]&&g[this._board][this[b+"Input"]].move(a[b])},b)})},_update:function(){},_initialize:function(){var a=document.getElementById(this.id).getElementsByTagName("input");for(i=0;i<a.length;i++)a[i].hasAttribute("data-axis")&&(this[a[i].getAttribute("data-axis")+"Input"]=a[i].id)}},palmNormal:{_listen:function(){var a=this;this.controller.on("frame",function(b){b.hands[0]&&(a.gammaInput&&g[a._board][a.gammaInput].move(b.hands[0].palmNormal[0]),a.alphaInput&&g[a._board][a.alphaInput].move(b.hands[0].palmNormal[1]),a.betaInput&&g[a._board][a.betaInput].move(b.hands[0].palmNormal[2]))})},_update:function(){},_initialize:function(){this.controller=new Leap.Controller,this.controller.connect(),this.controller.on("ready",function(){});var a=document.getElementById(this.id).getElementsByTagName("input");for(i=0;i<a.length;i++)a[i].hasAttribute("data-axis")&&(this[a[i].getAttribute("data-axis")+"Input"]=a[i].id)}},palmPosition:{_listen:function(){var a=this;this.controller.on("frame",function(b){b.hands[0]&&b.hands[0].fingers.length>=3&&(a.gammaInput&&g[a._board][a.gammaInput].move(b.hands[0].palmPosition[2]),a.alphaInput&&g[a._board][a.alphaInput].move(b.hands[0].palmPosition[1]),a.betaInput&&g[a._board][a.betaInput].move(b.hands[0].palmPosition[0]))})},_update:function(){},_initialize:function(){this.controller=new Leap.Controller,this.controller.connect(),this.controller.on("ready",function(){});var a=document.getElementById(this.id).getElementsByTagName("input");for(i=0;i<a.length;i++)a[i].hasAttribute("data-axis")&&(this[a[i].getAttribute("data-axis")+"Input"]=a[i].id)}},stabilizedPalmPosition:{_listen:function(){var a=this;this.controller.on("frame",function(b){b.hands[0]&&b.hands[0].fingers.length>=3&&(a.gammaInput&&g[a._board][a.gammaInput].move(b.hands[0].stabilizedPalmPosition[2]),a.alphaInput&&g[a._board][a.alphaInput].move(b.hands[0].stabilizedPalmPosition[1]),a.betaInput&&g[a._board][a.betaInput].move(b.hands[0].stabilizedPalmPosition[0]))})},_update:function(){},_initialize:function(){this.controller=new Leap.Controller,this.controller.connect(),this.controller.on("ready",function(){});var a=document.getElementById(this.id).getElementsByTagName("input");for(i=0;i<a.length;i++)a[i].hasAttribute("data-axis")&&(this[a[i].getAttribute("data-axis")+"Input"]=a[i].id)}}},p=document.createElement("script");return p.type="text/javascript",p.async=!0,p.onload=function(){f=io.connect(),f.on("connect",function(){console.log("connect"),d(g,function(a){f.emit("new board",a)})}),f.on("board ready",function(a){console.log("board ready"),g[a.id]._ready=!0,g[a.id].initialize()})},p.src="socket.io/socket.io.js",document.getElementsByTagName("head")[0].appendChild(p),g=b()}();